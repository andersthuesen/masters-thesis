\chapter{Appendices}

\section{Derivation of posterior distribution} \label{appendix:q-posterior-derivation}
\begin{align*}
    q(\mathbf{x}_{t-1} \vert \mathbf{x}_t, \mathbf{x}_0) &= q(\mathbf{x}_t \vert \mathbf{x}_{t-1}, \mathbf{x}_0) \frac{q(\mathbf{x}_{t-1} \vert \mathbf{x}_0)}{q(\mathbf{x}_t \vert \mathbf{x}_0)} \\
    \Leftrightarrow \log q(\mathbf{x}_{t-1} \vert \mathbf{x}_t, \mathbf{x}_0) &= \log q(\mathbf{x}_t \vert \mathbf{x}_{t-1}, \mathbf{x}_0) + 
    \log q(\mathbf{x}_{t-1} \vert \mathbf{x}_0) - \log q(\mathbf{x}_t \vert \mathbf{x}_0) \\
    &= \frac{1}{2} \left( 
        \frac{\left( \mathbf{x}_t - \sqrt{\alpha_t} \mathbf{x}_{t-1} \right)^2}{\beta_t} +
        \frac{\left( \mathbf{x}_{t-1} - \sqrt{\bar{\alpha}_{t-1}} \mathbf{x}_0 \right)^2}{1 - \bar{\alpha}_{t-1}} + 
        \frac{\left( \mathbf{x}_{t} - \sqrt{\bar{\alpha}_{t}} \mathbf{x}_0 \right)^2}{1 - \bar{\alpha}_{t}}
    \right) + K \\
    &= \frac{1}{2} \left(
        \frac{\mathbf{x}_t^2 - 2 \sqrt{\alpha_t}\mathbf{x}_t \mathbf{x}_{t-1} + \alpha_t \mathbf{x}_{t-1}^2}{\beta_t} +
        \frac{\mathbf{x}_{t-1}^2 - 2  \sqrt{\bar{\alpha}_{t-1}} \mathbf{x}_{t-1} \mathbf{x}_0 + \bar{\alpha}_{t-1}\mathbf{x}_0^2  }{1 - \bar{\alpha}_{t-1}} + C(x_t, x_0)
    \right) + K
\end{align*}

We collect all terms for $\mathbf{x}_{t-1}$ and $\mathbf{x}_{t-1}^2$. 
